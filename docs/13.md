## Auto-Reloading Components ðŸ”„

For components that display live, frequently changing dataâ€”like a news ticker, a dashboard chart, or a notification feedâ€”you can instruct `phpspa` to automatically refresh them at a set interval.

This is done by chaining the `->reload()` method to your component. This method is highly efficient, as it only re-fetches and updates the specific component, not the entire page.

### How to Use It

The `->reload()` method accepts one argument: the refresh interval in **milliseconds**.

Here is an example of a live clock component that updates itself every second.

```php
<?php
use phpSPA\App;
use phpSPA\Component;

// Assume our app and layout are set up
$app = new App($layout);

// --- Live Clock Component ---
$liveClock = new Component(function () {
    // This PHP code runs on the server every time the component is fetched
    $currentTime = date('H:i:s');
    return "<h2>Current Server Time: {$currentTime}</h2>";
});

// Configure the component to reload every 1000 milliseconds (1 second)
$liveClock
    ->route('/clock')
    ->title('Live Clock')
    ->reload(1000);

// Attach the component
$app->attach($liveClock);

$app->run();
```

When a user visits the `/clock` page, `phpspa`'s JavaScript runtime will see the reload instruction and automatically request a fresh version of the `liveClock` component every second, keeping the time perfectly up-to-date without any full page reloads.




================================================





## API Authentication

`phpspa` isn't just for rendering HTML. You can easily create secure API endpoints by creating components that return JSON. The `Request` object has built-in helpers to make checking for authentication credentials simple and clean.

This is perfect for when your frontend needs to fetch data from a secure source.

-----

### API Key Authentication

A common method for securing an API is to require an API key in the request headers. The `$request->apiKey()` method makes this easy to check.

By default, it looks for the key in the `Api-Key` header.

```php
<?php
use phpSPA\Component;
use phpSPA\Http\Request;

$userDataApi = new Component(function (Request $request) {
    // 1. Validate the API key.
    // Replace 'YOUR_SECRET_KEY' with your actual key.
    if (!$request->apiKey('YOUR_SECRET_KEY')) {
        http_response_code(401); // Unauthorized
        header('Content-Type: application/json');
        echo json_encode(['error' => 'Invalid API Key']);
        return;
    }

    // 2. If the key is valid, return the data.
    $data = ['id' => 123, 'name' => 'John Doe', 'email' => 'john.doe@example.com'];
    header('Content-Type: application/json');
    return json_encode($data);
});

$userDataApi->route('/api/user');
```

-----

### HTTP Basic & Bearer Token Authentication

For more standard authentication methods, the `$request->auth()` method is your go-to tool. It automatically parses the `Authorization` header and gives you access to both **Basic** and **Bearer** token credentials.

```php
<?php
use phpSPA\Component;
use phpSPA\Http\Request;

$secureDataApi = new Component(function (Request $request) {
    $auth = $request->auth();

    // Check for a Bearer token (commonly used with JWTs)
    if ($auth->bearer) {
        // ... validate the Bearer token ...
        if (isValidToken($auth->bearer)) {
            echo json_encode(['data' => 'This is your secure data.']);
            return;
        }
    }

    // Check for Basic auth credentials
    if ($auth->basic) {
        // $auth->basic is an object with 'user' and 'password' properties
        if ($auth->basic->user === 'admin' && $auth->basic->password === 'secret') {
            echo json_encode(['data' => 'Authenticated via Basic Auth.']);
            return;
        }
    }

    // If no valid auth is found, deny access.
    http_response_code(401);
    echo json_encode(['error' => 'Authentication required.']);
});

$secureDataApi->route('/api/secure-data');
```